plugins {
    id "com.android.application"          // åº”ç”¨ç¨‹åºæ’ä»¶ï¼Œæ„å»ºAndroidåº”ç”¨çš„å¿…å¤‡æ’ä»¶
    id "kotlin-android"                   // Kotlinæ’ä»¶ï¼Œæ”¯æŒKotlinè¯­è¨€ç¼–å†™çš„Androidä»£ç 
    id "dev.flutter.flutter-gradle-plugin" // Flutteræ’ä»¶ï¼Œç”¨äºæ„å»ºFlutteråº”ç”¨çš„å¿…å¤‡æ’ä»¶
}

// å®šä¹‰ä¸€ä¸ªPropertieså¯¹è±¡ï¼Œç”¨äºåŠ è½½local.propertiesæ–‡ä»¶ä¸­çš„é…ç½®
def localProperties = new Properties()
def localPropertiesFile = rootProject.file("local.properties") // è·å–local.propertiesæ–‡ä»¶
// å¦‚æœlocal.propertiesæ–‡ä»¶å­˜åœ¨ï¼Œåˆ™åŠ è½½æ–‡ä»¶ä¸­çš„å±æ€§
if (localPropertiesFile.exists()) {
    localPropertiesFile.withReader("UTF-8") { reader ->
        localProperties.load(reader) // ä½¿ç”¨UTF-8ç¼–ç åŠ è½½å±æ€§æ–‡ä»¶
    }
}

// ä»local.propertiesä¸­è·å–flutterç‰ˆæœ¬ä»£ç ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è®¾ç½®ä¸º"1"
def flutterVersionCode = localProperties.getProperty("flutter.versionCode")
if (flutterVersionCode == null) {
    flutterVersionCode = "1"
}

// ä»local.propertiesä¸­è·å–flutterç‰ˆæœ¬åç§°ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è®¾ç½®ä¸º"1.0"
def flutterVersionName = localProperties.getProperty("flutter.versionName")
if (flutterVersionName == null) {
    flutterVersionName = "1.0"
}

// Androidé…ç½®å—ï¼Œç”¨äºé…ç½®Androidæ„å»ºç›¸å…³çš„é€‰é¡¹
android {
    namespace = "net.itvapp.livetv" // å‘½åç©ºé—´ï¼Œç”¨äºå®šä¹‰åº”ç”¨çš„åŒ…å
    compileSdk = 35              // ç¼–è¯‘SDKç‰ˆæœ¬ï¼Œå®šä¹‰ç¼–è¯‘æ—¶ä½¿ç”¨çš„Android SDKç‰ˆæœ¬
    
    // ğŸ”¥ ä¿®å¤ï¼šç§»é™¤å†²çªçš„bundleé…ç½®ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨APKè€Œä¸æ˜¯AAB
    // bundleé…ç½®æ˜¯ç”¨äºAndroid App Bundle (AAB)çš„ï¼Œä¸APK splitså†²çª
    
    // ä¿ç•™APKåˆ†åŒ…é…ç½®
    splits {
        abi {
            enable true
            reset()
            include "armeabi-v7a", "arm64-v8a"
            universalApk true // åŒæ—¶ç”Ÿæˆé€šç”¨APKæé«˜å…¼å®¹æ€§
        }
    }
    
    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_17  // æŒ‡å®šJavaæºç çš„å…¼å®¹æ€§ç‰ˆæœ¬
        targetCompatibility = JavaVersion.VERSION_17  // æŒ‡å®šJavaç›®æ ‡å­—èŠ‚ç çš„å…¼å®¹æ€§ç‰ˆæœ¬
    }
    
    kotlinOptions {
        jvmTarget = "17" // æŒ‡å®šKotlinç¼–è¯‘çš„JVMç›®æ ‡ç‰ˆæœ¬
    }
    
    defaultConfig {
        applicationId = "net.itvapp.livetv" // åº”ç”¨ç¨‹åºIDï¼Œå³åŒ…å
        minSdk = 21                         // æœ€ä½æ”¯æŒçš„Android SDKç‰ˆæœ¬
        targetSdk = 35                      // ç›®æ ‡SDKç‰ˆæœ¬ï¼Œå®šä¹‰åº”ç”¨é’ˆå¯¹çš„Android SDKç‰ˆæœ¬
        versionCode = flutterVersionCode.toInteger() // åº”ç”¨ç‰ˆæœ¬ä»£ç ï¼Œä»local.propertiesè¯»å–
        versionName = flutterVersionName             // åº”ç”¨ç‰ˆæœ¬åç§°ï¼Œä»local.propertiesè¯»å–
        multiDexEnabled true // å¯ç”¨ MultiDex
    }
    
    signingConfigs {
        release {
            storeFile file("LIVETV.jks")                          // æŒ‡å®šç­¾åå¯†é’¥åº“æ–‡ä»¶
            storePassword System.getenv("KEYSTORE_PASSWORD")       // ç­¾åå¯†é’¥åº“å¯†ç ï¼Œä»ç¯å¢ƒå˜é‡è¯»å–
            keyAlias System.getenv("KEY_ALIAS")                    // ç­¾åå¯†é’¥åˆ«åï¼Œä»ç¯å¢ƒå˜é‡è¯»å–
            keyPassword System.getenv("KEY_ALIAS_PASSWORD")        // ç­¾åå¯†é’¥å¯†ç ï¼Œä»ç¯å¢ƒå˜é‡è¯»å–
        }
    }
    
    buildTypes {
        release {
            minifyEnabled true // å¯ç”¨ä»£ç æ··æ·†å’Œå‹ç¼©
            shrinkResources true // ç§»é™¤æœªä½¿ç”¨çš„èµ„æºï¼Œå‡å°‘APKçš„å¤§å°
            signingConfig = signingConfigs.release // ä½¿ç”¨releaseç­¾åé…ç½®
            // å¯ç”¨èµ„æºä¼˜åŒ–å’ŒR8å®Œå…¨æ¨¡å¼
            crunchPngs true
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
        }
        // ä¼˜åŒ–è°ƒè¯•æ„å»º
        debug {
            // è°ƒè¯•æ—¶ç¦ç”¨èµ„æºå‹ç¼©ä»¥åŠ å¿«æ„å»ºé€Ÿåº¦
            minifyEnabled false
            shrinkResources false
            // åº”ç”¨è°ƒè¯•ç­¾å
            signingConfig signingConfigs.debug
        }
    }
}

// Flutteræ’ä»¶é…ç½®å—ï¼Œç”¨äºæŒ‡å®šFlutteré¡¹ç›®çš„æºç›®å½•
flutter {
    source = "../.." // æŒ‡å®šFlutteré¡¹ç›®çš„æ ¹ç›®å½•ä½ç½®
}

// ä¾èµ–é¡¹é…ç½®å—ï¼Œç”¨äºå£°æ˜é¡¹ç›®çš„ä¾èµ–åº“
dependencies {
    coreLibraryDesugaring 'com.android.tools:desugar_jdk_libs:2.0.4'
    implementation 'androidx.multidex:multidex:2.0.1'
    
    // å®šä¹‰ç‰ˆæœ¬å˜é‡
    def lifecycleVersion = "2.8.0"
    def annotationVersion = "1.8.0"
    def workVersion = "2.9.0"
    def coreVersion = "1.13.0"
    
    implementation "androidx.lifecycle:lifecycle-runtime-ktx:$lifecycleVersion"
    implementation "androidx.lifecycle:lifecycle-common:$lifecycleVersion"
    implementation "androidx.lifecycle:lifecycle-common-java8:$lifecycleVersion"
    implementation "androidx.annotation:annotation:$annotationVersion"
    implementation "androidx.work:work-runtime:$workVersion"
    implementation "androidx.core:core-ktx:$coreVersion"
}
